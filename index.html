 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Culers - FC Barcelona Fan Hub</title>
    <link rel="stylesheet" href="styke.css">
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            height: 100vh;
        }
        .sidebar {
            width: 220px;
            background: linear-gradient(to bottom, #a50044, #004d98);
            color: white;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
         }
        .sidebar h2 {
            margin: 0 0 20px;
            text-align: center;
            font-size: 2em;
            letter-spacing: 1px;
            color: #fff;
        }
        .sidebar a {
            width: 100%;
            padding: 10px 20px;
            color: white;
            text-decoration: none;
            display: block;
            font-weight: bold;
            margin-left: 20px; /* Align text */
            box-sizing: border-box; /* Include padding in width */
            transition: background-color 0.3s ease;
        }
        .sidebar a:hover, .sidebar a.active-nav {
            background: rgba(255,255,255,0.2);
        }
        .main {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: white;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        .posts-feed-container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }

        /* INSTAGRAM-LIKE POST STYLES */
        .post {
            background: #fff;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            position: relative;
            overflow: hidden;
        }

        .post-header {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            position: relative; /* For ellipsis menu positioning */
        }

        .post-header strong {
            margin-right: auto;
        }

        /* Ellipsis Menu Button */
        .post-options-btn, .profile-options-btn { /* Added .profile-options-btn */
            background: none;
            border: none;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            padding: 0 10px;
            color: #555;
        }

        /* Ellipsis Dropdown Menu */
        .post-options-dropdown, .profile-options-dropdown { /* Added .profile-options-dropdown */
            position: absolute;
            top: 45px; /* Adjust based on header height */
            right: 10px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 100; /* Ensure it's above other content */
            display: none; /* Hidden by default */
            min-width: 120px;
            overflow: hidden; /* For rounded corners */
        }

        .post-options-dropdown button, .profile-options-dropdown button { /* Added .profile-options-dropdown button */
            display: block;
            width: 100%;
            padding: 8px 15px;
            text-align: left;
            background: none;
            border: none;
            font-size: 14px;
            color: #333;
            cursor: pointer;
            border-bottom: 1px solid #eee; /* Separator for menu items */
            border-radius: 0; /* Override default button radius */
        }

        .post-options-dropdown button:last-child, .profile-options-dropdown button:last-child { /* Added .profile-options-dropdown button */
            border-bottom: none; /* No border on the last item */
        }

        .post-options-dropdown button:hover, .profile-options-dropdown button:hover { /* Added .profile-options-dropdown button */
            background-color: #f0f0f0;
        }
        .post-options-dropdown button.delete-option, .profile-options-dropdown button.delete-option { /* Added .profile-options-dropdown button */
            color: crimson;
            font-weight: bold;
        }


        .post-media {
            width: 100%;
            background-color: #eee;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            max-height: 400px; /* Yaraynta cabbirka ugu badan */
        }

        .post-media img, .post-media video {
            width: 100%;
            height: auto;
            max-height: 100%; /* Hubi in sawirku uusan ka badnaan qaybta .post-media */
            object-fit: contain; /* Ama 'cover' haddii aad rabto inuu buuxiyo oo laga gooyo */
            display: block;
            border-radius: 0;
        }

        .post-content {
            padding: 10px 15px;
        }

        .post-actions {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .like-btn, .comment-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 0; /* Ka saar padding-kii hore */
            margin-right: 5px; /* Margin u dhexeeya like iyo count */
            display: flex; /* Ku dar si ay u isku xigaan icon-ka iyo text-ka */
            align-items: center; /* Ku hagaaji xariiqda dhexe */
        }
        .comment-btn {
            font-size: 20px;
            margin-left: 15px; /* Kordhi margin-ka comments-ka */
        }
        /* NEW: Share Button Style */
        .share-btn {
            background: none;
            border: none;
            font-size: 20px; /* Adjust size as needed */
            cursor: pointer;
            padding: 0;
            margin-left: 15px; /* Adjust margin as needed */
            color: #555; /* Icon color */
        }
        .share-btn:hover {
            color: #004d98; /* Hover color */
        }

        .post-likes-count {
            font-weight: bold;
            font-size: 14px;
            color: #333;
            /* No margin-left here, it will be right next to the like button */
        }

        .post-caption {
            font-size: 14px;
            margin-top: 5px;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        /* Initially hide comments section */
        .comments-section {
            display: none; /* Hidden by default */
        }

        .comment-input-area {
            display: flex;
            align-items: center;
            margin-top: 10px;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
        .comment-input-area input {
            flex-grow: 1;
            margin: 0 10px 0 0;
            border-radius: 20px;
            padding: 8px 15px;
            border: 1px solid #ddd;
            font-size: 14px;
        }
        .comment-input-area button {
            padding: 8px 15px;
            border-radius: 20px;
            background-color: #004d98;
            color: white;
            font-weight: normal;
            white-space: nowrap;
        }
        .comments-list {
            margin-top: 10px;
            font-size: 13px;
            max-height: 150px;
            overflow-y: auto;
        }
        .comment-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 5px;
        }
        .comment-item strong {
            margin-right: 5px;
            white-space: nowrap;
        }

        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
        }
        button {
            padding: 10px;
            background: #004d98;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 6px;
            font-weight: bold;
        }
        .profile-pic-small {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            cursor: pointer;
            background-color: #eee; /* Placeholder background */
        }
        .comment-box {
            margin-top: 10px;
        }
        /* NEW: Follow button style (visible) */
        .follow-button-visible {
            background-color: #004d98;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
            margin-left: 15px; /* Adjust margin as needed */
        }
        .follow-button-visible:hover {
            background-color: #003a7a;
        }


        /* PROFILE VIEW STYLES */
        .profile-container {
            max-width: 900px;
            background: white;
            margin: 0 auto;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative; /* For positioning logout button */
        }
        .profile-info-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 1px solid #ccc;
            margin-bottom: 20px;
        }
        .profile-pic-container {
            display: flex;
            justify-content: center;
        }
        .profile-pic-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #eee;
            background-position: center;
            background-size: cover;
            border: 3px solid #004d98;
            object-fit: cover;
        }
        .profile-stats-and-bio {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .profile-username-display {
            font-size: 24px;
            font-weight: 700;
            margin: 0 0 5px 0;
            display: flex;
            align-items: center;
            position: relative; /* For positioning the new profile options menu */
        }
        .profile-stats {
            display: flex;
            gap: 30px;
            margin-bottom: 10px;
        }
        .stat-item {
            text-align: center;
        }
        .stat-number {
            font-weight: bold;
            font-size: 18px;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        /* Styles for posts within the profile view */
        .profile-posts-section h3 {
            border-bottom: 2px solid #004d98;
            padding-bottom: 8px;
            font-weight: 700;
            color: #004d98;
            margin-bottom: 10px;
        }
        .profile-posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .profile-post-item {
            background: #fff;
            border-radius: 8px;
            padding: 12px 15px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
            word-break: break-word;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .profile-post-item img, .profile-post-item video {
            max-width: 100%;
            height: auto;
            max-height: 250px;
            object-fit: contain;
            border-radius: 4px;
            display: block;
            margin: 10px auto 0 auto;
        }
        /* Ellipsis menu on profile posts - re-using .profile-options-btn etc. */
        .delete-profile-post-btn { /* Specific button for deletion, position absolute */
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            padding: 0 5px;
            color: #555;
        }
        .profile-post-options-dropdown {
            position: absolute;
            top: 40px;
            right: 10px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 100;
            display: none;
            min-width: 120px;
            overflow: hidden;
        }
        .profile-post-options-dropdown button {
            display: block;
            width: 100%;
            padding: 8px 15px;
            text-align: left;
            background: none;
            border: none;
            font-size: 14px;
            color: #333;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            border-radius: 0;
        }
        .profile-post-options-dropdown button:last-child {
            border-bottom: none;
        }
        .profile-post-options-dropdown button:hover {
            background-color: #f0f0f0;
        }
        .profile-post-options-dropdown button.delete-option {
            color: crimson;
            font-weight: bold;
        }

        /* LOGOUT BUTTON POSITIONING */
        .logout-btn-container {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10; /* Ensure it's above other profile elements */
        }
        .logout-btn-container button {
            background-color: #a50044;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
        }

        /* NEW POST MODAL STYLES */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 200; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Could be responsive */
            max-width: 500px;
            border-radius: 10px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
            position: relative;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            right: 15px;
            top: 10px;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .modal-content h2 {
            margin-top: 0;
            color: #004d98;
            border-bottom: 2px solid #004d98;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .modal-content textarea {
            min-height: 100px;
            resize: vertical;
            border-radius: 5px;
            border: 1px solid #ddd;
            padding: 10px;
            font-size: 1em;
        }
        .modal-content input[type="file"] {
            border: 1px solid #ddd;
            padding: 8px;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .modal-content button {
            margin-top: 15px;
            width: 100%;
        }

        /* PROFILE EDIT MODAL STYLES */
        .profile-edit-modal-content {
            max-width: 400px;
        }
        .profile-edit-modal-content label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
            color: #333;
        }
        .profile-edit-modal-content input[type="text"],
        .profile-edit-modal-content textarea {
            width: calc(100% - 22px); /* Adjust for padding and border */
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 5px;
            font-size: 1em;
        }
        .profile-edit-modal-content button {
            margin-top: 20px;
        }

        /* CHANGE PROFILE PIC MODAL STYLES */
        .profile-pic-modal-content {
            max-width: 400px;
            text-align: center;
        }
        .profile-pic-modal-content input[type="file"] {
            margin-top: 15px;
        }
        .profile-pic-modal-content button {
            margin-top: 20px;
        }

        /* NOTIFICATION STYLES */
        .notification-container {
            max-width: 500px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            padding: 20px;
        }
        .notification-container h3 {
            margin-top: 0;
            color: #004d98;
            border-bottom: 2px solid #004d98;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .notification-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-size: 0.95em;
            color: #333;
            cursor: pointer; /* Make them clickable for marking as read */
        }
        .notification-item.unread {
            background-color: #e6f7ff; /* Light blue for unread */
            font-weight: bold;
        }
        .notification-item:last-child {
            border-bottom: none;
        }
        .notification-item img {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            background-color: #eee; /* Placeholder background */
        }
        .notification-item .timestamp {
            font-size: 0.8em;
            color: #888;
            margin-left: auto;
            white-space: nowrap;
        }
        .no-notifications {
            text-align: center;
            color: #666;
            padding: 20px;
        }

        /* NEW: Styles for the Explore/Shorts-like section (ONLY VIDEOS) */
        .explore-container {
            width: 100%;
            max-width: 400px; /* Narrower for Shorts/Reels feel */
            margin: 0 auto;
            padding: 10px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            height: calc(100vh - 40px); /* Adjust to fit screen with some padding */
            overflow-y: scroll;
            scroll-snap-type: y mandatory; /* Enable smooth snapping */
            -webkit-overflow-scrolling: touch; /* For smoother scrolling on iOS */
        }
        .explore-container h3 {
            margin-top: 0;
            color: #004d98;
            border-bottom: 2px solid #004d98;
            padding-bottom: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        .explore-item {
            scroll-snap-align: start; /* Snap to the start of each item */
            position: relative;
            width: 100%;
            height: calc(100vh - 80px); /* Make each item take almost full viewport height */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: black; /* Background for media */
            margin-bottom: 10px; /* Small gap between items */
            border-radius: 8px;
            overflow: hidden;
        }
        .explore-item video, .explore-item img { /* Ensure img is not shown here if only videos */
            max-width: 100%;
            max-height: 100%;
            object-fit: contain; /* Ensure media is visible within container */
            display: block;
        }
        .explore-item .overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0));
            color: white;
            padding: 20px;
            font-size: 0.9em;
        }
        .explore-item .overlay .overlay-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .explore-item .overlay .overlay-header img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            border: 2px solid white;
        }
        .explore-item .overlay .overlay-header strong {
            font-size: 1.1em;
            color: white;
        }
        .explore-item .overlay p {
            margin: 0;
            line-height: 1.4;
        }
        .explore-item .overlay .explore-actions {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
            color: white;
            font-size: 20px;
            text-align: center;
        }
        .explore-item .overlay .explore-actions button {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            margin: 0;
        }
        .explore-item .overlay .explore-actions span {
            font-size: 0.8em;
            display: block;
            margin-top: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
        .explore-item .overlay .explore-actions .share-btn {
            font-size: 24px; /* Adjust size for explore */
        }
        .humburgr{
            display: none;
        }
    </style>
</head>
<body>
    
 <div class="hamburger" onclick="toggleSidebar()">‚ò∞</div>
    
</div>
<nav class="sidebar" id="mainNav">

     <h2><i>CULERS</i></h2>
    <a href="#" id="home-link" onclick="showHome()">Home</a>
    <a href="#" id="post-link" onclick="showPost()">Post</a>
    <a href="#" id="explore-link" onclick="showExplore()">Explore</a>
    <a href="messages.html" id="messages-link">Messages</a>
    <a href="live chat.html" id="live-chat-link">Live Chat</a>
    <a href="#" id="profile-link" onclick="showProfile()">Profile</a>
    <a href="#" id="notifications-link" onclick="showNotifications()">Notifications</a>
</nav>

<main class="main" id="main-content"></main>

<div id="newPostModal" class="modal">
    <div class="modal-content">
        <span class="close-button" onclick="closePostModal()">&times;</span>
        <h2>Create New Post</h2>
        <textarea id="postText" placeholder="What's on your mind?"></textarea>
        <input type="file" id="mediaInput" accept="image/*,video/*">
        <button onclick="submitPost()">Post</button>
    </div>
</div>

<div id="editProfileModal" class="modal">
    <div class="modal-content profile-edit-modal-content">
        <span class="close-button" onclick="closeEditProfileModal()">&times;</span>
        <h2>Edit Profile</h2>
        <label for="editBio">Bio:</label>
        <textarea id="editBio"></textarea>
        <button onclick="saveProfileChanges()">Save Changes</button>
    </div>
</div>

<div id="changeProfilePicModal" class="modal">
    <div class="modal-content profile-pic-modal-content">
        <span class="close-button" onclick="closeProfilePicModal()">&times;</span>
        <h2>Change Profile Picture</h2>
        <input type="file" id="newProfilePicInput" accept="image/*">
        <button onclick="saveNewProfilePic()">Upload Picture</button>
    </div>
</div>



<script>
    // Redirect to login if not logged in
    if (!localStorage.getItem("loggedIn") || !localStorage.getItem("user")) {
        window.location.href = "login.html";
    }

    const currentUser = localStorage.getItem('user');
    let allUsers = JSON.parse(localStorage.getItem('allUsers') || "[]");
    const posts = JSON.parse(localStorage.getItem('posts') || "[]");

    // Store messages in localStorage
    // Format: { "user1_user2": [{sender: "user1", text: "hi"}, {sender: "user2", text: "hello"}] }
    // Ensure keys are sorted to be consistent (e.g., "abdirahman_xuseen" not "xuseen_abdirahman")
    function getConversationKey(user1, user2) {
        return [user1, user2].sort().join('_');
    }

    function getMessages(user1, user2) {
        const key = getConversationKey(user1, user2);
        return JSON.parse(localStorage.getItem('messages_' + key) || "[]");
    }

    function saveMessages(user1, user2, messages) {
        const key = getConversationKey(user1, user2);
        localStorage.setItem('messages_' + key, JSON.stringify(messages));
    }

    // Helper to get user profile picture
    function getUserProfilePic(username, size = 'small') {
        const user = allUsers.find(u => u.username === username);
        if (user && user.profilePic) {
            return user.profilePic;
        }
        if (size === 'large') {
            return 'https://via.placeholder.com/100?text=PP';
        }
        return 'https://via.placeholder.com/40?text=PP';
    }

    // Get following list for a user
    function getFollowingList(user) {
        return JSON.parse(localStorage.getItem('following_' + user) || "[]");
    }

    // Set following list for a user
    function setFollowingList(user, list) {
        localStorage.setItem('following_' + user, JSON.stringify(list));
    }

    // NEW: Get followers list for a user
    function getFollowersList(targetUser) {
        // Find all users who are following the targetUser
        return allUsers.filter(user => {
            const userFollowing = getFollowingList(user.username);
            return userFollowing.includes(targetUser);
        }).map(user => user.username);
    }

    // --- NOTIFICATION SYSTEM FUNCTIONS ---
    function getNotifications(username) {
        return JSON.parse(localStorage.getItem('notifications_' + username) || "[]");
    }

    function saveNotifications(username, notifications) {
        localStorage.setItem('notifications_' + username, JSON.stringify(notifications));
    }

    // Updated addNotification to properly target recipients
    function addNotification(type, byUser, recipientUser, targetPostId = null) {
        if (byUser === recipientUser) return; // Don't notify self for own actions

        let notifications = getNotifications(recipientUser);
        
        // Prevent duplicate follow notifications if already following
        if (type === 'follow' && notifications.some(n => n.type === 'follow' && n.byUser === byUser)) {
            return; 
        }
        
        notifications.unshift({ 
            id: Date.now(),
            type: type, // 'follow' or 'like'
            byUser: byUser,
            targetPostId: targetPostId, 
            timestamp: Date.now(),
            read: false
        });
        notifications = notifications.slice(0, 50); // Limit notifications

        saveNotifications(recipientUser, notifications);
    }

    function markNotificationAsRead(notificationId) {
        let notifications = getNotifications(currentUser);
        const notification = notifications.find(n => n.id === notificationId);
        if (notification) {
            notification.read = true;
            saveNotifications(currentUser, notifications);
            showNotifications(); // Refresh view
        }
    }

    function getUnreadNotificationCount() {
        return getNotifications(currentUser).filter(n => !n.read).length;
    }

    function getPostOwner(postId) {
        const post = posts.find(p => p.id === postId);
        return post ? post.user : null;
    }
    // --- END NOTIFICATION SYSTEM FUNCTIONS ---


    // Toggle follow/unfollow a user
    function toggleFollow(profileUsername) {
        if (profileUsername === currentUser) return; 

        let following = getFollowingList(currentUser);
        const isCurrentlyFollowing = following.includes(profileUsername);

        if (isCurrentlyFollowing) {
            // Unfollow
            following = following.filter(u => u !== profileUsername);
        } else {
            // Follow
            following.push(profileUsername);
            // NEW: Pass recipientUser for follow notification
            addNotification('follow', currentUser, profileUsername); 
        }
        setFollowingList(currentUser, following);
        
        // Re-render the current view to update follow button
        const mainContent = document.getElementById('main-content');
        const currentView = mainContent.dataset.currentView;

        if (currentView === 'profile' && mainContent.dataset.profileUsername === profileUsername) {
            showProfile(profileUsername); // Re-render the specific profile
        } else if (currentView === 'home') {
            showHome(); // Re-render the entire home feed
        }
    }

    // Function to set the active navigation link
    function setActiveNavLink(id) {
        document.querySelectorAll('.sidebar a').forEach(link => {
            link.classList.remove('active-nav');
        });
        document.getElementById(id)?.classList.add('active-nav');
    }

    // Toggle post options dropdown (for main feed posts)
    function togglePostOptions(event, postIndex) {
        event.stopPropagation();
        const dropdown = document.getElementById(`post-options-dropdown-${postIndex}`);
        if (dropdown.style.display === 'block') {
            dropdown.style.display = 'none';
        } else {
            document.querySelectorAll('.post-options-dropdown').forEach(d => d.style.display = 'none');
            document.querySelectorAll('.profile-post-options-dropdown').forEach(d => d.style.display = 'none');
            document.querySelectorAll('.profile-options-dropdown').forEach(d => d.style.display = 'none'); 
            dropdown.style.display = 'block';
        }
    }

    // Toggle profile post options dropdown (separate function to avoid ID conflicts)
    function toggleProfilePostOptions(event, postIndex) {
        event.stopPropagation();
        const dropdown = document.getElementById(`profile-post-options-dropdown-${postIndex}`);
        if (dropdown.style.display === 'block') {
            dropdown.style.display = 'none';
        } else {
            document.querySelectorAll('.post-options-dropdown').forEach(d => d.style.display = 'none');
            document.querySelectorAll('.profile-post-options-dropdown').forEach(d => d.style.display = 'none');
            document.querySelectorAll('.profile-options-dropdown').forEach(d => d.style.display = 'none'); 
            dropdown.style.display = 'block';
        }
    }

    // NEW: Toggle profile general options dropdown (for Follow/Unfollow)
    function toggleProfileOptions(event, username) {
        event.stopPropagation();
        const dropdown = document.getElementById(`profile-options-dropdown-${username}`);
        if (dropdown.style.display === 'block') {
            dropdown.style.display = 'none';
        } else {
            document.querySelectorAll('.post-options-dropdown').forEach(d => d.style.display = 'none');
            document.querySelectorAll('.profile-post-options-dropdown').forEach(d => d.style.display = 'none');
            document.querySelectorAll('.profile-options-dropdown').forEach(d => d.style.display = 'none'); 
            dropdown.style.display = 'block';
        }
    }


    // Close dropdowns when clicking anywhere else on the document
    document.addEventListener('click', (event) => {
        document.querySelectorAll('.post-options-dropdown').forEach(d => {
            if (!d.contains(event.target)) {
                d.style.display = 'none';
            }
        });
        document.querySelectorAll('.profile-post-options-dropdown').forEach(d => {
            if (!d.contains(event.target)) {
                d.style.display = 'none';
            }
        });
        document.querySelectorAll('.profile-options-dropdown').forEach(d => { 
            if (!d.contains(event.target)) {
                d.style.display = 'none';
            }
        });
    });

    // Toggle comments section visibility
    function toggleComments(postIndex) {
        const commentsSection = document.getElementById(`comments-section-${postIndex}`);
        if (commentsSection) {
            if (commentsSection.style.display === 'block') {
                commentsSection.style.display = 'none';
            } else {
                commentsSection.style.display = 'block';
            }
        }
    }


    // Display the home page with all posts
    function showHome() {
        setActiveNavLink('home-link');
        document.getElementById('main-content').dataset.currentView = 'home';

        let html = `<div class="posts-feed-container">`;
        [...posts].reverse().forEach((p, postDisplayIndex) => {
            const postOwnerPic = getUserProfilePic(p.user, 'small');
            
            const actualPostIndex = posts.length - 1 - postDisplayIndex;

            const postOptionsHtml = p.user === currentUser ? `
                <button class="post-options-btn" onclick="togglePostOptions(event, ${actualPostIndex})">...</button>
                <div id="post-options-dropdown-${actualPostIndex}" class="post-options-dropdown">
                    <button onclick="editPost(${actualPostIndex})">Edit</button>
                    <button class="delete-option" onclick="deletePost(${actualPostIndex})">Delete</button>
                </div>
            ` : '';

            if (!p.likes) p.likes = [];
            const liked = p.likes.includes(currentUser);
            const likeLabel = `${p.likes.length} like${p.likes.length === 1 ? '' : 's'}`;
            
            if (!p.comments) p.comments = [];
            
            const commentsHtml = p.comments.map((c, commentIndex) => {
                const deleteCommentBtn = (p.user === currentUser || c.user === currentUser) 
                    ? `<button class="delete-btn" onclick="deleteComment(${actualPostIndex}, ${commentIndex})" style="margin-left: 5px; background: none; border: none; color: #a50044; cursor: pointer;">Delete</button>` 
                    : '';
                return `
                    <div class="comment-item">
                        <strong>${c.user}</strong><span>${c.text}</span>
                        ${deleteCommentBtn}
                    </div>
                `;
            }).join('');

            html += `
                <div class="post">
                    <div class="post-header">
                        <img src="${postOwnerPic}" class="profile-pic-small" onclick="showProfile('${p.user}')">
                        <strong onclick="showProfile('${p.user}')" style="cursor:pointer;">${p.user}</strong>
                        ${postOptionsHtml}
                    </div>
                    <div class="post-media">
                        ${p.media ? `<${p.media.type} src="${p.media.url}" ${p.media.type === 'video' ? 'controls' : ''}></${p.media.type}>` : ''}
                    </div>
                    <div class="post-content">
                        <div class="post-actions">
                            <button class="like-btn" onclick="toggleLike(${postDisplayIndex})">${liked ? '‚ù§Ô∏è' : 'ü§ç'}</button>
                            <span class="post-likes-count">${likeLabel}</span>
                            <button class="comment-btn" onclick="toggleComments(${actualPostIndex})">üí¨</button>
                            <button class="share-btn" onclick="sharePost(${actualPostIndex})">üì§</button>
                        </div>
                        <p class="post-caption"><strong>${p.user}</strong> ${p.text}</p>
                        
                        <div id="comments-section-${actualPostIndex}" class="comments-section">
                            <div class="comments-list">
                            ${commentsHtml}
                            </div>
                            <div class="comment-input-area">
                            <input type="text" placeholder="Add a comment..." onkeypress="if(event.key==='Enter') sendComment(${postDisplayIndex}, this)">
                            <button onclick="sendComment(${postDisplayIndex}, this.previousElementSibling)">Post</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
        html += `</div>`;
        document.getElementById("main-content").innerHTML = html;
    }

    // Toggle like status for a post
    function toggleLike(postDisplayIndex) {
        const actualIndex = posts.length - 1 - postDisplayIndex;
        const post = posts[actualIndex];
        if (!post.likes) post.likes = [];

        const liked = post.likes.includes(currentUser);
        if (liked) {
            post.likes = post.likes.filter(u => u !== currentUser);
        } else {
            post.likes.push(currentUser);
            // NEW: Pass recipientUser for like notification (post owner)
            addNotification('like', currentUser, post.user, post.id); 
        }

        localStorage.setItem("posts", JSON.stringify(posts));
        
        // Re-render based on current view to ensure likes are updated correctly
        const currentView = document.getElementById('main-content').dataset.currentView;
        if (currentView === 'home') {
            showHome(); 
        } else if (currentView === 'explore') {
            showExplore();
        }
    }

    // Send a new comment to a post
    function sendComment(postDisplayIndex, inputEl) {
        const text = inputEl.value.trim();
        if (!text) return;
        const actualIndex = posts.length - 1 - postDisplayIndex;
        const post = posts[actualIndex];
        if (!post.comments) post.comments = [];
        post.comments.push({ user: currentUser, text });
        localStorage.setItem('posts', JSON.stringify(posts));
        inputEl.value = '';
        
        // Re-render and keep comments section open
        const currentView = document.getElementById('main-content').dataset.currentView;
        if (currentView === 'home') {
            showHome();
            setTimeout(() => {
                const commentsSection = document.getElementById(`comments-section-${actualIndex}`);
                if (commentsSection) {
                    commentsSection.style.display = 'block';
                    commentsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }, 0);
        } else if (currentView === 'explore') {
             showExplore(); // Re-render explore, comments won't be in overlay for simplicity
        }
    }

    // Delete a post (called from ellipsis menu)
    function deletePost(originalIndex) {
        if (confirm("Are you sure you want to delete this post?")) {
            posts.splice(originalIndex, 1);
            localStorage.setItem('posts', JSON.stringify(posts));
            const currentView = document.getElementById('main-content').dataset.currentView;
            if (currentView === 'home') {
                showHome();
            } else if (currentView === 'profile') {
                showProfile(document.getElementById('main-content').dataset.profileUsername);
            } else if (currentView === 'explore') {
                showExplore();
            }
        }
    }

    // Function to initiate editing a post
    function editPost(originalIndex) {
        const postToEdit = posts[originalIndex];
        if (!postToEdit) return;

        openPostModal(); // Open the post creation modal
        document.getElementById("postText").value = postToEdit.text;
        // Note: For media, you'd typically have a way to preview or remove it,
        // but re-uploading would be required for changes.
        // For simplicity, we just allow text edit or new media upload.

        localStorage.setItem('editingPostIndex', originalIndex);
    }

    // Modify submitPost to handle both new posts and edits
    function submitPost() {
        const editingPostIndex = localStorage.getItem('editingPostIndex');
        const text = document.getElementById("postText").value.trim();
        const mediaInput = document.getElementById("mediaInput");
        const mediaFile = mediaInput.files[0];

        if (!text && !mediaFile && editingPostIndex === null) {
            alert("Post cannot be empty.");
            return;
        }
        
        let postData = {};

        if (editingPostIndex !== null) { // Editing existing post
            const originalPost = posts[parseInt(editingPostIndex)];
            postData = { ...originalPost }; // Copy existing post data
            postData.text = text; // Update text

            // If a new media file is selected, update it
            if (mediaFile) {
                let reader = new FileReader();
                reader.onload = function() {
                    postData.media = {
                        url: reader.result,
                        type: mediaFile.type.startsWith('image') ? 'img' : 'video'
                    };
                    posts[parseInt(editingPostIndex)] = postData; // Update the post in the array
                    localStorage.setItem("posts", JSON.stringify(posts));
                    closePostModal();
                    showHome(); // Refresh home feed
                };
                reader.readAsDataURL(mediaFile);
                return; // Exit to wait for reader.onload
            } else {
                // If no new media, retain existing media or remove if no text
                if (!text && !postData.media) {
                    alert("Post cannot be empty after edit if no media is present.");
                    return;
                }
                posts[parseInt(editingPostIndex)] = postData;
            }

        } else { // Creating new post
            postData = {
                id: Date.now(), // Simple unique ID
                user: currentUser,
                text: text,
                likes: [],
                comments: []
            };

            if (mediaFile) {
                let reader = new FileReader();
                reader.onload = function() {
                    postData.media = {
                        url: reader.result,
                        type: mediaFile.type.startsWith('image') ? 'img' : 'video'
                    };
                    posts.push(postData);
                    localStorage.setItem("posts", JSON.stringify(posts));
                    closePostModal();
                    showHome(); // Refresh home feed
                };
                reader.readAsDataURL(mediaFile);
                return; // Exit to wait for reader.onload
            } else {
                posts.push(postData);
            }
        }
        
        localStorage.setItem("posts", JSON.stringify(posts));
        closePostModal();
        showHome(); // Refresh home feed
    }

    // NEW: sharePost function (Placeholder for actual share functionality)
    function sharePost(originalIndex) {
        const postToShare = posts[originalIndex];
        if (postToShare) {
            // In a real application, this would open a share dialog or copy a link.
            // For now, let's just alert the user.
            const shareText = `Check out this post by ${postToShare.user}: "${postToShare.text}"`;
            alert(`Sharing Post:\n\n${shareText}\n\n(In a real app, this would open a share dialog or copy a link!)`);
            
            // You could also use the Web Share API if supported:
            /*
            if (navigator.share) {
                navigator.share({
                    title: `Post by ${postToShare.user}`,
                    text: postToShare.text,
                    url: window.location.href // Or a specific URL for the post
                }).then(() => {
                    console.log('Post shared successfully');
                }).catch((error) => {
                    console.error('Error sharing:', error);
                });
            } else {
                alert(`Sharing Post:\n\n${shareText}\n\n(Web Share API not supported on this browser)`);
            }
            */
        }
    }

    // Display the post creation form
    function showPost() {
        setActiveNavLink('post-link');
        document.getElementById('main-content').dataset.currentView = 'post';
        // Open modal instead of rendering inline form
        openPostModal(); 
        localStorage.removeItem('editingPostIndex'); // Clear any previous editing state
    }

    // Function to open the New Post Modal
    function openPostModal() {
        document.getElementById('newPostModal').style.display = 'flex';
        document.getElementById("postText").value = ''; // Clear text
        document.getElementById("mediaInput").value = ''; // Clear file input
        localStorage.removeItem('editingPostIndex'); // Ensure fresh start
    }

    // Function to close the New Post Modal
    function closePostModal() {
        document.getElementById('newPostModal').style.display = 'none';
        document.getElementById("postText").value = '';
        document.getElementById("mediaInput").value = '';
        showHome(); // Return to home view after closing post modal
    }

    // Show profile page
    function showProfile(username = currentUser) {
        setActiveNavLink('profile-link');
        const mainContent = document.getElementById('main-content');
        mainContent.dataset.currentView = 'profile';
        mainContent.dataset.profileUsername = username; 

        const profileUser = allUsers.find(u => u.username === username);
        if (!profileUser) {
            mainContent.innerHTML = `<p>User not found.</p>`;
            return;
        }

        const isCurrentUserProfile = username === currentUser;
        const isFollowing = getFollowingList(currentUser).includes(username);
        
        // Follow/Unfollow button logic
        let followButtonHtml = '';
        if (!isCurrentUserProfile) {
            if (isFollowing) {
                // If following, only ellipsis with "Unfollow" option
                followButtonHtml = `
                    <button class="profile-options-btn" onclick="toggleProfileOptions(event, '${username}')">...</button>
                    <div id="profile-options-dropdown-${username}" class="profile-options-dropdown">
                        <button class="delete-option" onclick="toggleFollow('${username}')">Unfollow</button>
                    </div>
                `;
            } else {
                // If not following, show "Follow" button directly
                followButtonHtml = `<button class="follow-button-visible" onclick="toggleFollow('${username}')">Follow</button>`;
            }
        }
        
        const profilePosts = posts.filter(p => p.user === username);
        const profilePostsHtml = profilePosts.length > 0 ? profilePosts.map((p, pIndex) => {
            const originalIndex = posts.findIndex(op => op === p);

            const postOptionsHtml = isCurrentUserProfile ? `
                <button class="delete-profile-post-btn" onclick="toggleProfilePostOptions(event, ${originalIndex})">...</button>
                <div id="profile-post-options-dropdown-${originalIndex}" class="profile-post-options-dropdown">
                    <button onclick="editPost(${originalIndex})">Edit</button>
                    <button class="delete-option" onclick="deletePost(${originalIndex})">Delete</button>
                </div>
            ` : '';

            // Handle potential empty text for media-only posts
            const postTextDisplay = p.text ? `<p><strong>${p.user}</strong> ${p.text}</p>` : '';

            return `
                <div class="profile-post-item">
                    ${p.media ? `<${p.media.type} src="${p.media.url}" ${p.media.type === 'video' ? 'controls' : ''}></${p.media.type}>` : ''}
                    ${postTextDisplay}
                    ${postOptionsHtml}
                </div>
            `;
        }).join('') : '<p style="text-align: center; color:#666;">No posts yet.</p>';

        mainContent.innerHTML = `
            <div class="profile-container">
                ${isCurrentUserProfile ? `<div class="logout-btn-container"><button onclick="logout()">Logout</button></div>` : ''}
                <div class="profile-info-grid">
                    <div class="profile-pic-container">
                        <img src="${getUserProfilePic(username, 'large')}" alt="${username} Profile" class="profile-pic-large" ${isCurrentUserProfile ? 'onclick="changeProfilePic()"' : ''}>
                    </div>
                    <div class="profile-stats-and-bio">
                        <h2 class="profile-username-display">
                            ${username} ${!isCurrentUserProfile ? followButtonHtml : ''}
                        </h2>
                        <div class="profile-stats">
                            <div class="stat-item"><span class="stat-number">${profilePosts.length}</span> <span class="stat-label">Posts</span></div>
                            <div class="stat-item"><span class="stat-number">${getFollowersList(username).length}</span> <span class="stat-label">Followers</span></div>
                            <div class="stat-item"><span class="stat-number">${getFollowingList(username).length}</span> <span class="stat-label">Following</span></div>
                        </div>
                        <p class="profile-bio">${profileUser.bio || 'No bio yet.'}</p>
                        ${isCurrentUserProfile ? `
                            <button onclick="editProfile()">Edit Profile</button>
                        ` : ''}
                    </div>
                </div>
                <div class="profile-posts-section">
                    <h3>Posts</h3>
                    <div class="profile-posts-grid">
                        ${profilePostsHtml}
                    </div>
                </div>
            </div>
        `;
    }

    // Function to open the Edit Profile Modal
    function editProfile() {
        const user = allUsers.find(u => u.username === currentUser);
        if (user) {
            document.getElementById('editBio').value = user.bio || '';
            document.getElementById('editProfileModal').style.display = 'flex';
        }
    }

    // Function to close the Edit Profile Modal
    function closeEditProfileModal() {
        document.getElementById('editProfileModal').style.display = 'none';
    }

    // Function to save profile changes
    function saveProfileChanges() {
        const bio = document.getElementById('editBio').value.trim();
        
        let user = allUsers.find(u => u.username === currentUser);
        if (user) {
            user.bio = bio;
            localStorage.setItem('allUsers', JSON.stringify(allUsers));
            closeEditProfileModal();
            showProfile(currentUser); // Refresh profile view
        }
    }

    // Function to open the Change Profile Picture Modal
    function changeProfilePic() {
        document.getElementById('changeProfilePicModal').style.display = 'flex';
    }

    // Function to close the Change Profile Picture Modal
    function closeProfilePicModal() {
        document.getElementById('changeProfilePicModal').style.display = 'none';
        document.getElementById('newProfilePicInput').value = ''; // Clear input
    }

    // Function to save new profile picture
    function saveNewProfilePic() {
        const newProfilePicInput = document.getElementById('newProfilePicInput');
        const file = newProfilePicInput.files[0];

        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                let user = allUsers.find(u => u.username === currentUser);
                if (user) {
                    user.profilePic = e.target.result; // Store as base64
                    localStorage.setItem('allUsers', JSON.stringify(allUsers));
                    closeProfilePicModal();
                    showProfile(currentUser); // Refresh profile view
                    showHome(); // Also refresh home to update user pic in posts
                }
            };
            reader.readAsDataURL(file);
        } else {
            alert("Please select a file.");
        }
    }

    // NEW: Show Notifications Page
    function showNotifications() {
        setActiveNavLink('notifications-link');
        document.getElementById('main-content').dataset.currentView = 'notifications';

        const notifications = getNotifications(currentUser);
        let notificationsHtml = '';

        if (notifications.length === 0) {
            notificationsHtml = '<p class="no-notifications">No new notifications.</p>';
        } else {
            notifications.forEach(n => {
                const userPic = getUserProfilePic(n.byUser, 'small');
                const timeAgo = formatTimeAgo(n.timestamp);
                let message = '';
                let actionLink = '';

                if (n.type === 'follow') {
                    message = `<span onclick="showProfile('${n.byUser}')" style="cursor:pointer; font-weight:bold;">${n.byUser}</span> started following you.`;
                } else if (n.type === 'like' && n.targetPostId) {
                    const post = posts.find(p => p.id === n.targetPostId);
                    if (post) {
                        message = `<span onclick="showProfile('${n.byUser}')" style="cursor:pointer; font-weight:bold;">${n.byUser}</span> liked your post: "${post.text.substring(0, 50)}${post.text.length > 50 ? '...' : ''}"`;
                        // Adjusting scroll to post logic for better reliability
                        actionLink = `<a href="#" onclick="showHome(); setTimeout(() => {
                            const allPosts = document.querySelectorAll('.post');
                            for (let i = 0; i < allPosts.length; i++) {
                                // Find the matching post using the original ID in the posts array
                                const currentPostId = posts[posts.length - 1 - i].id; 
                                if (currentPostId === ${n.targetPostId}) {
                                    allPosts[i].scrollIntoView({ behavior: 'smooth', block: 'center' });
                                    break;
                                }
                            }
                        }, 500); return false;"> (View Post)</a>`;
                    } else {
                        // Post deleted, handle gracefully
                        message = `<span onclick="showProfile('${n.byUser}')" style="cursor:pointer; font-weight:bold;">${n.byUser}</span> liked a post that is no longer available.`;
                    }
                }
                
                notificationsHtml += `
                    <div class="notification-item ${n.read ? '' : 'unread'}" onclick="markNotificationAsRead(${n.id})">
                        <img src="${userPic}" alt="${n.byUser}" class="profile-pic-small">
                        <span>${message}${actionLink}</span>
                        <span class="timestamp">${timeAgo}</span>
                    </div>
                `;
            });
        }

        document.getElementById('main-content').innerHTML = `
            <div class="notification-container">
                <h3>Notifications</h3>
                ${notificationsHtml}
            </div>
        `;
    }

    // NEW: showExplore() Function (formerly showVideos) - now shows ONLY VIDEO posts like Shorts/Reels
    function showExplore() {
        setActiveNavLink('explore-link');
        document.getElementById('main-content').dataset.currentView = 'explore';

        let exploreHtml = `<div class="explore-container"><h3>Explore Videos</h3>`;

        const videoPosts = posts.filter(p => p.media && p.media.type === 'video');

        if (videoPosts.length === 0) {
            exploreHtml += `<p style="text-align: center; color: #666;">No videos to explore yet.</p>`;
        } else {
            // Iterate through video posts, newest first
            [...videoPosts].reverse().forEach((p, displayIndex) => {
                const postOwnerPic = getUserProfilePic(p.user, 'small');
                const actualPostIndex = posts.findIndex(post => post.id === p.id); // Get original index for likes/shares

                let mediaHtml = '';
                if (p.media && p.media.type === 'video') {
                    mediaHtml = `<video src="${p.media.url}" autoplay loop muted playsinline></video>`;
                } else {
                    // This block should ideally not be reached if filtered correctly
                    return; 
                }

                if (!p.likes) p.likes = [];
                const liked = p.likes.includes(currentUser);
                const likeLabel = p.likes.length; // Just number for explore view
                
                const commentLabel = p.comments ? p.comments.length : 0;


                exploreHtml += `
                    <div class="explore-item">
                        ${mediaHtml}
                        <div class="overlay">
                            <div class="overlay-header">
                                <img src="${postOwnerPic}" onclick="showProfile('${p.user}')">
                                <strong onclick="showProfile('${p.user}')">${p.user}</strong>
                            </div>
                            <p>${p.text}</p>
                            <div class="explore-actions">
                                <div>
                                    <button class="like-btn" onclick="toggleLike(${actualPostIndex})">${liked ? '‚ù§Ô∏è' : 'ü§ç'}</button>
                                    <span>${likeLabel}</span>
                                </div>
                                <div>
                                    <button class="comment-btn" onclick="alert('Comments for this post. (In a real app, this would open a comments overlay)')">üí¨</button>
                                    <span>${commentLabel}</span>
                                </div>
                                <div>
                                    <button class="share-btn" onclick="sharePost(${actualPostIndex})">üì§</button>
                                    <span>Share</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        exploreHtml += `</div>`;
        document.getElementById("main-content").innerHTML = exploreHtml;

        // Autoplay videos when they are in view (simple logic, could be more robust)
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                const video = entry.target.querySelector('video');
                if (video) {
                    if (entry.isIntersecting) {
                        video.play();
                    } else {
                        video.pause();
                        video.currentTime = 0; // Reset video when out of view
                    }
                }
            });
        }, { threshold: 0.7 }); // Trigger when 70% of the video is visible

        document.querySelectorAll('.explore-item').forEach(item => {
            observer.observe(item);
        });
    }


    // Helper function to format time
    function formatTimeAgo(timestamp) {
        const seconds = Math.floor((new Date() - new Date(timestamp)) / 1000);

        let interval = seconds / 31536000;
        if (interval > 1) {
            return Math.floor(interval) + " years ago";
        }
        interval = seconds / 2592000;
        if (interval > 1) {
            return Math.floor(interval) + " months ago";
        }
        interval = seconds / 86400;
        if (interval > 1) {
            return Math.floor(interval) + " days ago";
        }
        interval = seconds / 3600;
        if (interval > 1) {
            return Math.floor(interval) + " hours ago";
        }
        interval = seconds / 60;
        if (interval > 1) {
            return Math.floor(interval) + " minutes ago";
        }
        return Math.floor(seconds) + " seconds ago";
    }

    // Logout function
    function logout() {
        if (confirm("Are you sure you want to log out?")) {
            localStorage.removeItem("loggedIn");
            localStorage.removeItem("user");
            window.location.href = "login.html";
        }
    }

    // Initial load based on redirect or default to home
    document.addEventListener('DOMContentLoaded', () => {
        const redirectToPost = localStorage.getItem('redirectToShowPost');
        if (redirectToPost === 'true') {
            localStorage.removeItem('redirectToShowPost');
            showPost();
            return;
        }

        const redirectToProfile = localStorage.getItem('redirectToShowProfile');
        if (redirectToProfile === 'true') {
            localStorage.removeItem('redirectToShowProfile');
            showProfile(currentUser); 
            return;
        }

        // Handle direct navigation to live_chat.html
        if (window.location.pathname.endsWith('live_chat.html')) {
             // If already on live_chat.html, nothing to do here.
             // The live_chat.html file itself handles its display.
        } else {
            showHome();
        }
    });
    
  



</script>

<script>
  function toggleSidebar() {
  const humburger = document.getElementById("mainNav");
  const currentDisplay = window.getComputedStyle(humburger).display;

  if (currentDisplay === "block") {
    humburger.style.display = "none";
  } else {
    humburger.style.display = "block";
  }
}



  
</script>
  

</body>
</html>